<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kollus Upload API í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #95a4e8 0%, #a67fcd 100%);
            min-height: 100vh;
        }

        .container {
            background: white;
            border-radius: 15px;


            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 30px;
            margin-bottom: 20px;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #555;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .response-container {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            overflow-x: auto;
        }

        .error {
            background: #fff5f5;
            border-color: #fed7d7;
            color: #c53030;
        }

        .success {
            background: #f0fff4;
            border-color: #9ae6b4;
            color: #2f855a;
        }

        .upload-section {
            display: none;
            background: #e8f5e8;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .upload-section.active {
            display: block;
        }

        .progress-bar {
            width: 100%;
            background: #e0e0e0;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .step {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .step:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .step h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 12px;
            line-height: 1.4;
        }

        .info-box {
            background: #e6f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .info-box h4 {
            color: #0066cc;
            margin-top: 0;
        }

        .home-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            z-index: 1000;
        }

        .home-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
    </style>
</head>
<body>
    <a href="index.html" class="home-button">
        ğŸ  í™ˆìœ¼ë¡œ ê°€ê¸°
    </a>
    
    <div class="container">
        <h1>ğŸ¬ Kollus Upload API í…ŒìŠ¤íŠ¸</h1>

        <div class="info-box">
            <h4>ğŸ“‹ ì‚¬ìš© ë°©ë²•</h4>
            <p>1. Access Tokenê³¼ Category Keyë¥¼ ì…ë ¥í•©ë‹ˆë‹¤<br>
            2. "ì—…ë¡œë“œ URL ìƒì„±" ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤<br>
            3. ìƒì„±ëœ ì—…ë¡œë“œ URLë¡œ íŒŒì¼ì„ ì—…ë¡œë“œí•©ë‹ˆë‹¤</p>
        </div>

        <div class="step">
            <h3>1ë‹¨ê³„: ì—…ë¡œë“œ URL ìƒì„±</h3>

            <div class="form-group">
                <label for="accessToken">Access Token *</label>
                <input type="text" id="accessToken" placeholder="API ì ‘ê·¼ í† í°ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>

            <div class="form-group">
                <label for="categoryKey">Category Key</label>
                <input type="text" id="categoryKey" placeholder="ì¹´í…Œê³ ë¦¬ í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­)">
            </div>

            <div class="form-group">
                <label for="expireTime">ë§Œë£Œ ì‹œê°„ (ì´ˆ)</label>
                <input type="number" id="expireTime" value="600" min="1" max="21600">
            </div>

            <div class="form-group">
                <label for="title">ì»¨í…ì¸  ì œëª©</label>
                <input type="text" id="title" placeholder="ì—…ë¡œë“œí•  íŒŒì¼ì˜ ì œëª© (ì„ íƒì‚¬í•­)">
            </div>

            <div class="form-group">
                <label for="uploadType">ì—…ë¡œë“œ íƒ€ì…</label>
                <select id="uploadType">
                    <option value="normal">ì¼ë°˜ ì—…ë¡œë“œ</option>
                    <option value="passthrough">íŒ¨ìŠ¤ì“°ë£¨ ì—…ë¡œë“œ</option>
                    <option value="filelive">íŒŒì¼ë¼ì´ë¸Œ ì—…ë¡œë“œ</option>
                </select>
            </div>

            <div class="form-group" id="profileKeyGroup" style="display: none;">
                <label for="profileKey">Profile Key</label>
                <input type="text" id="profileKey" placeholder="íŒ¨ìŠ¤ì“°ë£¨ ì—…ë¡œë“œì‹œ í•„ìˆ˜">
            </div>

            <button id="createUrlBtn">ì—…ë¡œë“œ URL ìƒì„±</button>
            <button id="clearBtn">ê²°ê³¼ ì§€ìš°ê¸°</button>

            <div id="urlResponse" class="response-container" style="display: none;"></div>
        </div>

        <div class="step">
            <h3>2ë‹¨ê³„: íŒŒì¼ ì—…ë¡œë“œ</h3>
            <div class="upload-section" id="uploadSection">
                <div class="form-group">
                    <label for="fileInput">ì—…ë¡œë“œí•  íŒŒì¼ ì„ íƒ</label>
                    <input type="file" id="fileInput" accept="video/*,audio/*,.mp4,.avi,.mov,.wmv,.flv,.webm,.mkv,.m4v,.3gp,.ts,.mts,.m2ts,.vob,.ogv,.asf,.rm,.rmvb,.dv,.mxf,.xvid,.divx,.f4v,.mp3,.wav,.aac,.ogg,.flac,.m4a,.wma,.ra,.amr,.ape,.opus,.qt,.3g2,.3gp2,.3gpp,.3gpp2,.3ga,.3ga2,.3gpa,.3gpp3,.3gpp4,.m4b,.m4p,.m4r,.f4a,.f4b,.f4p,.f4r,.f4s,.f4t,.f4u,.f4w,.f4x,.f4y,.f4z">
                </div>

                <div class="form-group">
                    <label for="returnUrl">Return URL (ì„ íƒì‚¬í•­)</label>
                    <input type="text" id="returnUrl" placeholder="ì—…ë¡œë“œ ì™„ë£Œ í›„ ë¦¬ë‹¤ì´ë ‰íŠ¸í•  URL">
                </div>

                <button id="uploadBtn">íŒŒì¼ ì—…ë¡œë“œ</button>
                <button id="progressBtn">ì§„í–‰ë¥  í™•ì¸</button>

                <div class="progress-bar" id="progressBar" style="display: none;">
                    <div class="progress-fill" id="progressFill">0%</div>
                </div>

                <div id="uploadResponse" class="response-container" style="display: none;"></div>
            </div>
        </div>
    </div>

    <script>
        // Kollus API í´ë˜ìŠ¤ë“¤ì„ ì§ì ‘ ì •ì˜
        console.log('Kollus API í´ë˜ìŠ¤ ë¡œë“œ ì‹œì‘...');
        
        class KollusUploadAPI {
            constructor(accessToken, baseUrl = 'https://c-api-kr.kollus.com') {
                this.accessToken = accessToken;
                this.baseUrl = baseUrl;
            }
            
            async createUploadUrl(params) {
                const { expireTime, categoryKey, title, uploadType, profileKey } = params;
                // API URL ì„¤ì •
                let apiUrl = `${this.baseUrl}/api/upload/create-url`;
                if (uploadType === 'passthrough' || uploadType === 'filelive') {
                    apiUrl = 'https://upload.kr.kollus.com/api/v1/create_url';
                }
                // POST ë°ì´í„° êµ¬ì„±
                const postData = {
                    expire_time: expireTime,
                    category_key: categoryKey,
                    title: title,
                    is_encryption_upload: 0,
                    is_audio_upload: 0,
                    is_passthrough: uploadType === 'passthrough' ? 1 : 0
                };
                // íŒ¨ìŠ¤ì“°ë£¨ ì—…ë¡œë“œì‹œ profile_key ì¶”ê°€
                if (uploadType === 'passthrough') {
                    if (!profileKey) {
                        throw new Error('Profile KeyëŠ” íŒ¨ìŠ¤ì“°ë£¨ ì—…ë¡œë“œì‹œ í•„ìˆ˜ì…ë‹ˆë‹¤.');
                    }
                    postData.profile_key = profileKey;
                }
                // íŒŒì¼ë¼ì´ë¸Œ ì—…ë¡œë“œì‹œ selected_profile_key ì¶”ê°€
                if (uploadType === 'filelive') {
                    postData.selected_profile_key = categoryKey + '-filelive';
                }
                const formData = new FormData();
                Object.keys(postData).forEach(key => {
                    if (postData[key] !== undefined && postData[key] !== '') {
                        formData.append(key, String(postData[key]));
                    }
                });
                const response = await fetch(`${apiUrl}?access_token=${encodeURIComponent(this.accessToken)}`, {
                    method: 'POST',
                    body: formData
                });
                return await response.json();
            }
            
            async uploadFile(params) {
                const { uploadUrl, file, returnUrl } = params;
                const formData = new FormData();
                formData.append('upload-file', file);
                formData.append('disable_alert', '1');
                formData.append('accept', 'application/json');
                if (returnUrl) {
                    formData.append('return_url', returnUrl);
                    formData.append('redirection_scope', 'outer');
                }
                const response = await fetch(uploadUrl, {
                    method: 'POST',
                    body: formData
                });
                return await response.json();
            }
            
            async checkProgress(progressUrl) {
                const response = await fetch(progressUrl);
                return await response.json();
            }
        }
        
        class UploadProgressMonitor {
            constructor(progressUrl) {
                this.progressUrl = progressUrl;
            }
            
            start(params) {
                const { onProgress, onComplete, onError, intervalMs = 1000 } = params;
                this.onProgress = onProgress;
                this.onComplete = onComplete;
                this.onError = onError;
                this.intervalId = setInterval(async () => {
                    try {
                        const response = await fetch(this.progressUrl);
                        const result = await response.json();
                        if (result.error === 0 && result.result) {
                            const progress = result.result.progress;
                            this.onProgress?.(progress);
                            if (progress >= 100) {
                                this.stop();
                                this.onComplete?.();
                            }
                        }
                    }
                    catch (error) {
                        this.stop();
                        this.onError?.(error);
                    }
                }, intervalMs);
            }
            
            stop() {
                if (this.intervalId) {
                    clearInterval(this.intervalId);
                    this.intervalId = undefined;
                }
            }
        }
        
        class KollusUtils {
            static formatExpireTime(timestamp) {
                return new Date(timestamp * 1000).toLocaleString('ko-KR', {
                    timeZone: 'Asia/Seoul'
                });
            }
            
            static formatFileSize(bytes) {
                const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
                if (bytes === 0)
                    return '0 Bytes';
                const i = Math.floor(Math.log(bytes) / Math.log(1024));
                return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
            }
            
            static isValidFileType(file) {
                // ì§€ì›í•˜ëŠ” MIME íƒ€ì…ë“¤
                const validMimeTypes = [
                    // ë¹„ë””ì˜¤ íŒŒì¼
                    'video/mp4', 'video/avi', 'video/mov', 'video/quicktime', 'video/wmv', 'video/flv',
                    'video/webm', 'video/mkv', 'video/m4v', 'video/3gp', 'video/ts',
                    'video/mts', 'video/m2ts', 'video/vob', 'video/ogv', 'video/asf',
                    'video/rm', 'video/rmvb', 'video/dv', 'video/mxf', 'video/xvid',
                    'video/x-msvideo', 'video/x-ms-wmv', 'video/x-flv', 'video/x-matroska',
                    // ì˜¤ë””ì˜¤ íŒŒì¼
                    'audio/mp3', 'audio/wav', 'audio/aac', 'audio/ogg', 'audio/flac',
                    'audio/m4a', 'audio/wma', 'audio/ra', 'audio/amr', 'audio/ape',
                    'audio/opus', 'audio/webm', 'audio/mp4', 'audio/3gpp', 'audio/3gpp2',
                    'audio/x-wav', 'audio/x-aiff', 'audio/x-m4a', 'audio/x-ms-wma'
                ];
                // ì§€ì›í•˜ëŠ” íŒŒì¼ í™•ì¥ìë“¤
                const validExtensions = [
                    // ë¹„ë””ì˜¤ í™•ì¥ì
                    '.mp4', '.avi', '.mov', '.wmv', '.flv', '.webm', '.mkv', '.m4v',
                    '.3gp', '.ts', '.mts', '.m2ts', '.vob', '.ogv', '.asf', '.rm',
                    '.rmvb', '.dv', '.mxf', '.xvid', '.divx', '.f4v', '.f4p', '.f4a',
                    '.f4b', '.m4b', '.m4p', '.m4r', '.m4v', '.3g2', '.3gp2', '.3gpp',
                    '.3gpp2', '.3ga', '.3ga2', '.3gpa', '.3gpp2', '.3gpp3', '.3gpp4',
                    // ì˜¤ë””ì˜¤ í™•ì¥ì
                    '.mp3', '.wav', '.aac', '.ogg', '.flac', '.m4a', '.wma', '.ra',
                    '.amr', '.ape', '.opus', '.webm', '.mp4', '.3gpp', '.3gpp2', '.3ga',
                    '.3ga2', '.3gpa', '.3gpp3', '.3gpp4', '.m4b', '.m4p', '.m4r', '.f4a',
                    '.f4b', '.f4p', '.f4v', '.f4r', '.f4s', '.f4t', '.f4u', '.f4w',
                    '.f4x', '.f4y', '.f4z'
                ];
                // MIME íƒ€ì… ê²€ì¦
                if (validMimeTypes.includes(file.type)) {
                    return true;
                }
                // íŒŒì¼ í™•ì¥ì ê²€ì¦ (MIME íƒ€ì…ì´ ì—†ëŠ” ê²½ìš°)
                const fileName = file.name.toLowerCase();
                return validExtensions.some(ext => fileName.endsWith(ext));
            }
        }
        
        console.log('Kollus API í´ë˜ìŠ¤ ë¡œë“œ ì™„ë£Œ');

        let api;
        let uploadUrl = '';
        let progressUrl = '';
        let uploadFileKey = '';
        let progressMonitor;

        // ì—…ë¡œë“œ íƒ€ì… ë³€ê²½ì‹œ í”„ë¡œíŒŒì¼ í‚¤ í•„ë“œ í‘œì‹œ/ìˆ¨ê¹€
        document.getElementById('uploadType').addEventListener('change', function() {
            const profileKeyGroup = document.getElementById('profileKeyGroup');
            if (this.value === 'passthrough') {
                profileKeyGroup.style.display = 'block';
            } else {
                profileKeyGroup.style.display = 'none';
            }
        });

        async function createUploadUrl() {
            console.log('createUploadUrl í•¨ìˆ˜ ì‹œì‘');
            const accessToken = document.getElementById('accessToken').value.trim();
            const categoryKey = document.getElementById('categoryKey').value.trim();
            const expireTime = parseInt(document.getElementById('expireTime').value);
            const title = document.getElementById('title').value.trim();
            const uploadType = document.getElementById('uploadType').value;
            const profileKey = document.getElementById('profileKey').value.trim();

            if (!accessToken) {
                showResponse('urlResponse', 'Access Tokenì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            try {
                showResponse('urlResponse', 'ì—…ë¡œë“œ URL ìƒì„± ì¤‘...', '');
                
                // ë””ë²„ê¹…: API í´ë˜ìŠ¤ í™•ì¸
                console.log('KollusUploadAPI í´ë˜ìŠ¤:', typeof KollusUploadAPI);
                console.log('KollusUploadAPI í´ë˜ìŠ¤ ë‚´ìš©:', KollusUploadAPI);
                console.log('API ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì‹œë„...');

                // API ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
                api = new KollusUploadAPI(accessToken);
                
                console.log('API ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì„±ê³µ:', api);
                console.log('API ìš”ì²­ íŒŒë¼ë¯¸í„°:', {
                    expireTime: expireTime,
                    categoryKey: categoryKey,
                    title: title,
                    uploadType: uploadType,
                    profileKey: profileKey
                });
                console.log('API ìš”ì²­ ì‹œì‘...');

                const urlResponse = await api.createUploadUrl({
                    expireTime: expireTime,
                    categoryKey: categoryKey,
                    title: title,
                    uploadType: uploadType,
                    profileKey: profileKey
                });

                // API ì‘ë‹µ ë””ë²„ê¹…
                console.log('API ì‘ë‹µ:', urlResponse);
                console.log('ì‘ë‹µ íƒ€ì…:', typeof urlResponse);
                console.log('ì‘ë‹µ í‚¤ë“¤:', Object.keys(urlResponse));

                // ìƒˆë¡œìš´ ì‘ë‹µ êµ¬ì¡° (data/status) ë˜ëŠ” ê¸°ì¡´ êµ¬ì¡° (error/result) ëª¨ë‘ ì§€ì›
                let responseData;
                let expireTimestamp;

                if (urlResponse.status === 'ok' && urlResponse.data) {
                    // ìƒˆë¡œìš´ ì‘ë‹µ êµ¬ì¡°
                    responseData = urlResponse.data;
                    expireTimestamp = urlResponse.data.expired_at;
                } else if (urlResponse.error === 0 && urlResponse.result) {
                    // ê¸°ì¡´ ì‘ë‹µ êµ¬ì¡°
                    responseData = urlResponse.result;
                    expireTimestamp = urlResponse.result.will_be_expired_at;
                } else {
                    throw new Error('ì•Œ ìˆ˜ ì—†ëŠ” ì‘ë‹µ êµ¬ì¡°ì…ë‹ˆë‹¤.');
                }

                uploadUrl = responseData.upload_url;
                progressUrl = responseData.progress_url;
                uploadFileKey = responseData.upload_file_key;

                const expireDate = KollusUtils.formatExpireTime(expireTimestamp);

                showResponse('urlResponse',
                    `âœ… ì—…ë¡œë“œ URL ìƒì„± ì„±ê³µ!\n\n` +
                    `ğŸ“¤ ì—…ë¡œë“œ URL: ${uploadUrl}\n` +
                    `ğŸ“Š ì§„í–‰ë¥  URL: ${progressUrl}\n` +
                    `ğŸ”‘ íŒŒì¼ í‚¤: ${uploadFileKey}\n` +
                    `â° ë§Œë£Œ ì‹œê°„: ${expireDate}`,
                    'success'
                );

                // ì—…ë¡œë“œ ì„¹ì…˜ í™œì„±í™”
                document.getElementById('uploadSection').classList.add('active');
            } catch (error) {
                console.error('API ìš”ì²­ ì˜¤ë¥˜:', error);
                console.error('ì˜¤ë¥˜ ìŠ¤íƒ:', error.stack);
                showResponse('urlResponse', `âŒ ìš”ì²­ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        async function uploadFile() {
            if (!uploadUrl || !api) {
                showResponse('uploadResponse', 'ë¨¼ì € ì—…ë¡œë“œ URLì„ ìƒì„±í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            const fileInput = document.getElementById('fileInput');
            const returnUrl = document.getElementById('returnUrl').value.trim();

            if (!fileInput.files[0]) {
                showResponse('uploadResponse', 'ì—…ë¡œë“œí•  íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            const file = fileInput.files[0];

            // íŒŒì¼ íƒ€ì… ê²€ì¦
            console.log('íŒŒì¼ ì •ë³´:', {
                name: file.name,
                type: file.type,
                size: file.size
            });
            
            // ì¶”ê°€ íŒŒì¼ íƒ€ì… ê²€ì¦ (QuickTime íŒŒì¼ íŠ¹ë³„ ì²˜ë¦¬)
            const fileName = file.name.toLowerCase();
            const isQuickTimeFile = fileName.endsWith('.mov') || file.type === 'video/quicktime';
            const isVideoFile = file.type.startsWith('video/') || fileName.match(/\.(mp4|avi|mov|wmv|flv|webm|mkv|m4v|3gp|ts|mts|m2ts|vob|ogv|asf|rm|rmvb|dv|mxf|xvid|divx|f4v|qt)$/);
            const isAudioFile = file.type.startsWith('audio/') || fileName.match(/\.(mp3|wav|aac|ogg|flac|m4a|wma|ra|amr|ape|opus)$/);
            
            if (!KollusUtils.isValidFileType(file) && !isQuickTimeFile && !isVideoFile && !isAudioFile) {
                showResponse('uploadResponse', `ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ íƒ€ì…ì…ë‹ˆë‹¤: ${file.name} (${file.type || 'ì•Œ ìˆ˜ ì—†ëŠ” íƒ€ì…'}). ë¹„ë””ì˜¤ë‚˜ ì˜¤ë””ì˜¤ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.`, 'error');
                return;
            }

            try {
                showResponse('uploadResponse', 'íŒŒì¼ ì—…ë¡œë“œ ì¤‘...', '');
                document.getElementById('progressBar').style.display = 'block';

                // ì§„í–‰ë¥  ëª¨ë‹ˆí„°ë§ ì‹œì‘
                if (progressUrl) {
                    progressMonitor = new UploadProgressMonitor(progressUrl);
                    progressMonitor.start({
                        onProgress: (progress) => {
                            updateProgress(progress);
                        },
                        onComplete: () => {
                            console.log('ì—…ë¡œë“œ ì™„ë£Œ!');
                        },
                        onError: (error) => {
                            console.error('ì§„í–‰ë¥  ëª¨ë‹ˆí„°ë§ ì˜¤ë¥˜:', error);
                        }
                    });
                }

                const uploadResponse = await api.uploadFile({
                    uploadUrl: uploadUrl,
                    file: file,
                    returnUrl: returnUrl
                });

                // ì—…ë¡œë“œ ì‘ë‹µ ë””ë²„ê¹…
                console.log('ì—…ë¡œë“œ ì‘ë‹µ:', uploadResponse);
                console.log('ì‘ë‹µ íƒ€ì…:', typeof uploadResponse);
                console.log('ì‘ë‹µ í‚¤ë“¤:', Object.keys(uploadResponse));

                // ì—…ë¡œë“œ ì„±ê³µ ì—¬ë¶€ í™•ì¸ (ë‹¤ì–‘í•œ ì‘ë‹µ êµ¬ì¡° ì§€ì›)
                const isSuccess = uploadResponse.result === 'S' || 
                                uploadResponse.status === 'ok' || 
                                uploadResponse.success === true ||
                                (uploadResponse.message && uploadResponse.message.toLowerCase().includes('success'));

                if (isSuccess) {
                    showResponse('uploadResponse',
                        `âœ… íŒŒì¼ ì—…ë¡œë“œ ì„±ê³µ!\n\n` +
                        `ğŸ“ íŒŒì¼ëª…: ${file.name}\n` +
                        `ğŸ“ íŒŒì¼ í¬ê¸°: ${KollusUtils.formatFileSize(file.size)}\n` +
                        `ğŸ“Š ê²°ê³¼: ${uploadResponse.message || 'ì—…ë¡œë“œ ì™„ë£Œ'}`,
                        'success'
                    );
                    updateProgress(100);
                } else {
                    const errorMessage = uploadResponse.message || uploadResponse.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
                    showResponse('uploadResponse',
                        `âŒ ì—…ë¡œë“œ ì‹¤íŒ¨: ${errorMessage}`,
                        'error'
                    );
                }

                // ì§„í–‰ë¥  ëª¨ë‹ˆí„°ë§ ì¤‘ì§€
                if (progressMonitor) {
                    progressMonitor.stop();
                }
            } catch (error) {
                showResponse('uploadResponse', `âŒ ì—…ë¡œë“œ ì‹¤íŒ¨: ${error.message}`, 'error');
                if (progressMonitor) {
                    progressMonitor.stop();
                }
            }
        }

        async function checkProgress() {
            if (!progressUrl || !api) return;

            try {
                const result = await api.checkProgress(progressUrl);

                if (result.error === 0 && result.result && result.result.progress !== undefined) {
                    const progress = result.result.progress;
                    updateProgress(progress);
                    showResponse('uploadResponse', `ğŸ“Š í˜„ì¬ ì§„í–‰ë¥ : ${progress}%`, '');
                }
            } catch (error) {
                console.log('ì§„í–‰ë¥  ì²´í¬ ì‹¤íŒ¨:', error);
            }
        }

        function updateProgress(percentage) {
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = percentage + '%';
            progressFill.textContent = percentage + '%';
        }

        function showResponse(elementId, message, type) {
            const responseDiv = document.getElementById(elementId);
            responseDiv.style.display = 'block';
            responseDiv.className = `response-container ${type}`;

            if (type === 'error' || type === 'success') {
                responseDiv.innerHTML = `<pre>${message}</pre>`;
            } else {
                responseDiv.innerHTML = message;
            }
        }

        function clearResponse() {
            document.getElementById('urlResponse').style.display = 'none';
            document.getElementById('uploadResponse').style.display = 'none';
            document.getElementById('uploadSection').classList.remove('active');
            document.getElementById('progressBar').style.display = 'none';

            uploadUrl = '';
            progressUrl = '';
            uploadFileKey = '';
            
            if (progressMonitor) {
                progressMonitor.stop();
            }
        }

        // DOMì´ ì™„ì „íˆ ë¡œë“œëœ í›„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM ë¡œë“œ ì™„ë£Œ, ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì¤‘...');
            
            const createUrlBtn = document.getElementById('createUrlBtn');
            console.log('createUrlBtn ìš”ì†Œ:', createUrlBtn);
            
            if (createUrlBtn) {
                createUrlBtn.addEventListener('click', function(e) {
                    console.log('ì—…ë¡œë“œ URL ìƒì„± ë²„íŠ¼ í´ë¦­ë¨!');
                    e.preventDefault();
                    createUploadUrl().catch(error => {
                        console.error('createUploadUrl ì˜¤ë¥˜:', error);
                    });
                });
            }
            
            document.getElementById('clearBtn').addEventListener('click', clearResponse);
            document.getElementById('uploadBtn').addEventListener('click', uploadFile);
            document.getElementById('progressBtn').addEventListener('click', checkProgress);
        });
    </script>
</body>
</html>
